<!DOCTYPE html><html><head>    <!-- 页面meta -->    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <title>基于SpringBoot整合SSM案例</title>    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">    <!-- 引入样式 -->    <link rel="stylesheet" href="../plugins/elementui/index.css">    <link rel="stylesheet" href="../plugins/font-awesome/css/font-awesome.min.css">    <link rel="stylesheet" href="../css/style.css">    <!-- Google Font: Source Sans Pro -->    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">    <!-- Font Awesome -->    <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">    <!-- DataTables -->    <link rel="stylesheet" href="../plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">    <link rel="stylesheet" href="../plugins/datatables-responsive/css/responsive.bootstrap4.min.css">    <link rel="stylesheet" href="../plugins/datatables-buttons/css/buttons.bootstrap4.min.css">    <link rel="stylesheet" href="https://unpkg.com/vinalla/dist/vinalla/vinalla.min.css">    <!-- Theme style -->    <link rel="stylesheet" href="../dist/css/adminlte.min.css">    <script src="../plugins/jquery/jquery.min.js"></script>    <script src="../plugins/jquery/jquery-3.2.1.js"></script>    <script src="../plugins/jquery/json3.js"></script>    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.1.2/echarts.min.js"></script></head><body class="hold-transition"><!-- Main Sidebar Container --><aside class="main-sidebar sidebar-dark-primary elevation-4">    <!-- Brand Logo -->    <a href="" class="brand-link">        <img src="../../dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">        <span class="brand-text font-weight-light">燃气异常系统</span>    </a>    <!-- Sidebar -->    <div class="sidebar">        <!-- Sidebar user (optional) -->        <!-- Sidebar Menu -->        <nav class="mt-2">            <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">                <!-- Add icons to the links using the .nav-icon class                     with font-awesome or any other icon font library -->                <li class="nav-header">———用户管理———</li>                <li class="nav-item">                    <a href="user.html" class="nav-link">                        <p>                            用户信息管理                        </p>                    </a>                    <a href="learn.html" class="nav-link">                        <p>                            知识学习                        </p>                    </a>            </ul>        </nav>        <!-- /.sidebar-menu -->    </div>    <!-- /.sidebar --></aside><div id="app">    <div class="content-header">        <div class="username-container" style="display: flex; align-items: center; justify-content: space-between;">            <!-- 新增组按钮 -->            <el-button type="success" @click="this.handleCreate">申请恢复燃气</el-button>            <!-- 消息通知按钮，带红点 -->            <div style="margin: 0 20px;">                <el-badge :is-dot="isNewMessage" class="item">                    <!-- 在click事件后，调用你的checkForMessages函数 -->                    <el-button type="primary" @click="this.checkForMessages">消息通知</el-button>                </el-badge>                <el-dialog                        title="消息通知"                        :visible.sync="dialogVisible"                        width="30%"                        :before-close="handleClose">                    <span>{{ message.msg }}</span>                </el-dialog>            </div>            <!-- 用户信息下拉菜单 -->            <el-dropdown trigger="click" @command="this.handleCommand">                <div class="user-panel mt-3 pb-3 mb-3 d-flex">                    <div class="image">                        <img src="../../dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">                    </div>                    <div class="info">                        <a href="#" class="d-block el-dropdown-link">                            {{user.username}}                        </a>                    </div>                </div>                <el-dropdown-menu slot="dropdown">                    <el-dropdown-item command="updateProfile">修改信息</el-dropdown-item>                    <el-dropdown-item command="logout">退出登录</el-dropdown-item>                </el-dropdown-menu>            </el-dropdown>        </div>    </div>    <div class="content-wrapper" style="margin-top: 50px;">        <div class="box">            <div id="chart" style="width: 1200px;height:600px;"></div><            </div>            <div class="add-form">                <el-dialog title="填写申请表" :visible.sync="dialogFormVisible">                    <el-form ref="dataAddForm" :model="formData" :rules="rules" label-position="right" label-width="100px">                        <el-row>                            <el-col :span="12">                                <el-form-item label="手机号码" prop="name">                                    <el-input v-model="formData.number"/>                                </el-form-item>                            </el-col>                        </el-row>                        <el-row>                            <el-col :span="24">                                <el-form-item label="描述">                                    <el-input v-model="formData.reason" type="textarea"></el-input>                                </el-form-item>                            </el-col>                        </el-row>                    </el-form>                    <div slot="footer" class="dialog-footer">                        <el-button @click="cancel()">取消</el-button>                        <el-button type="primary" @click="handleAdd()">确定</el-button>                    </div>                </el-dialog>            </div>            <div class="add-form">                <el-dialog title="编辑个人信息" :visible.sync="dialogFormVisible4Edit">                    <el-form ref="dataEditForm" :model="formData" :rules="rules" label-position="right" label-width="100px">                        <el-row>                            <el-col :span="12">                                <el-form-item label="用户名" prop="username">                                    <el-input v-model="formData.username"/>                                </el-form-item>                            </el-col>                            <el-col :span="12">                                <el-form-item label="居住地址" prop="address">                                    <el-input v-model="formData.address"/>                                </el-form-item>                            </el-col>                        </el-row>                        <el-row>                            <el-col :span="24">                                <el-form-item label="手机号码">                                    <el-input v-model="formData.number" type="textarea"></el-input>                                </el-form-item>                            </el-col>                        </el-row>                    </el-form>                    <div slot="footer" class="dialog-footer">                        <el-button @click="cancel()">取消</el-button>                        <el-button type="primary" @click="handleEdit()">确定</el-button>                    </div>                </el-dialog>            </div>        </div>    </div></div></body><!-- 引入组件库 --><script src="../js/vue.js"></script><script src="../plugins/elementui/index.js"></script><script type="text/javascript" src="../js/jquery.min.js"></script><script src="../js/axios-0.18.0.js"></script><script>    var vue = new Vue({        el: '#app',        data:{            user:null,            groupOptions: [],            dataList: [],//当前页要展示的列表数据            dialogFormVisible: false,//添加表单是否可见            dialogFormVisible4Edit:false,//编辑表单是否可见            showButton:true,            isNewMessage: false,//判断红点是否显示的变量            message: {},//用来保存消息的内容            dialogVisible: false,//控制MessageBox是否显示            formData: {},//表单数据            bookData: [],            rules: {//校验规则                type: [{ required: true, message: '申请人为必填项', trigger: 'blur' }],                name: [{ required: true, message: '手机号为必填项', trigger: 'blur' }]            },            pagination: {//分页相关模型数据                currentPage: 1,//当前页码                pageSize:10,//每页显示的记录数                total:0,//总记录数                type: "",                name: "",                description: ""            }        },        //钩子函数，VUE对象初始化完成后自动执行      created() {            this.getUserData();             this.getAll();        },        mounted(){            setTimeout(() => {                this.generateSurfaceChart();            }, 2000);        },        methods: {            checkForMessages() {                axios.get('http://localhost:8080/message?id='+this.user.id)                    .then((response) => {                        if (response.data.msg==='') {                            if (response.data.isread) {                                this.isNewMessage = true;                            }                            console.log(response.data.data);                            this.message = response.data.data;                            console.log(this.message);                            this.dialogVisible = true;                        } else {                            this.$message.info("没有消息");                        }                    })                    .catch((error) => {                        console.error('get request error', error);                    });            },            showMessage() {            },            handleClose(done) {                if (!this.isNewMessage) {                    done();                } else {                    axios.post(`http://localhost:8080/message?id=${this.messageId}`, { isread: false })                        .then(() => {                            this.isNewMessage = false;                            done();                        })                        .catch((error) => {                            console.error('Failed to update message status:', error);                        });                }            },            async getUserData() {               await axios.get('http://localhost:8080/person')                    .then(response => {                        this.user = response.data.data;                    })                    .catch(error => {                        console.log(error);                    });            },            handleCommand(command) {                if (command === 'logout') {                    this.logout()                }                if(command === 'updateProfile'){                    this.updateUser()                }                // 处理其他的 command            },            logout() {                console.log('Logout method is triggered!');                // Logout logic here...                window.location.href = '/logout';  // Say '/logout' is your login page.            },            updateUser(){                axios.get("/person/").then( (res)=>{                    if(res.data.data){                        this.dialogFormVisible4Edit=true;                        this.formData=res.data.data;                    }else{                        this.$message.error("数据同步失败");                    }                }).finally(()=>{                    this.getAll();                });            },            async getAll() {                await axios.get("/group").then((res)=>{                   this.dataList=res.data.data;                });            },            getOrderId(id) {                axios.get("/order/getOrder/"+id).then((res)=>{                    this.dataList=res.data.data;                });            },            //分页查询            toggleButton(){                this.showButton=!this.showButton;            },            //切换页码            handleCurrentChange(currentPage) {                this.pagination.currentPage=currentPage;                this.getAll();            },            //条件查询            //弹出添加窗口            handleCreate() {                if(this.user.isnull !== '正常') {                    this.dialogFormVisible = true;                    this.resetForm();                } else {                    this.$message.info("燃气数据正常，无需填写");                }            },            //重置表单            resetForm() {                this.formData={};            },            //添加            handleAdd () {                this.formData.user_id=this.user.id                this.formData.handleResult=this.user.isnull                this.formData.user_name=this.user.username                let today = new Date();                let yyyy = today.getFullYear();                let mm = String(today.getMonth() + 1).padStart(2, "0"); //Months are zero based so add 1 and pad single digit months with a leading 0                let dd = String(today.getDate()).padStart(2, "0"); // Pad single digit date with a leading 0                this.formData.application_data = `${yyyy}/${mm}/${dd}`;                axios.post("/application",this.formData).then((res)=>{                    if(res.data.flag){                        this.dialogFormVisible=false;                        this.$message.success("添加成功");                    }else{                        this.message.error("添加失败");                    }                }).finally(()=>{                    this.getAll();                });            },            cancel(){                this.dialogFormVisible=false;                this.dialogFormVisible4Edit=false;            },            //弹出编辑窗口            handleUpdate(row) {                axios.get("/order/getOrderBook/"+row).then( (res)=>{                    if(res.data.flag){                    this.dialogFormVisible4Edit=true;                    this.bookData=res.data.data;                    }else{                        this.$message.error("数据同步失败");                    }                }).finally(()=>{                        this.getOrderId(id);                });            },            //修改            handleEdit() {                axios.put("/books",this.formData).then((res)=>{                    if(res.data.flag){                        this.dialogFormVisible4Edit=false;                        this.$message.success("修改成功");                    }else{                        this.message.error(res.data.msg);                    }                }).finally(()=>{                    this.getAll();                });            },            handleDelete(row) {                this.$confirm("此操作永久删除是否继续？","提示",{type:"info"}).then(()=>{                    axios.delete("/group?groupid="+row.groupid).then((res)=>{                        if(res.data.flag){                            this.$message.success("删除成功");                        }else{                            this.message.error("删除失败");                        }}).finally(()=>{                        this.getAll();                    });                }).catch(()=>{                    this.$message.info("取消操作");                })            },            handleEdit() {                axios.put("/person",this.formData).then((res)=>{                    if(res.data.flag){                        this.dialogFormVisible4Edit=false;                        this.$message.success("修改成功");                    }else{                        this.message.error(res.data.msg);                    }                }).finally(()=>{                    this.getAll();                });            },            generateSurfaceChart() {                const url = `http://localhost:8080/chart/e?username=${this.user.username}`;                axios.get(url)                    .then(response => {                        const weekDays = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];                        const actualData = response.data.data.actual;                        const predictedData = response.data.data.predicted;                        const labels = Array.from({ length: 168 }, (_, i) => `${weekDays[Math.floor(i/24)]}第${i%24 + 1}小时`);                        let myChart = echarts.init(document.getElementById('chart'));                        let option = {                            title: {                                text: '用气'+this.user.isnull                            },                            tooltip: {                                trigger: 'axis'                            },                            legend: {                                data: ['实际用气量', '预测用气量']                            },                            grid: {                                left: '3%',                                right: '4%',                                bottom: '3%',                                containLabel: true                            },                            toolBox: {                                feature: {                                    saveAsImage: {}                                }                            },                            xAxis: {                                type: 'category',                                boundaryGap: false,                                data: labels                            },                            yAxis: {                                type: 'value'                            },                            series: [                                {                                    name: '实际用气量',                                    type: 'line',                                    data: actualData                                },                                {                                    name: '预测用气量',                                    type: 'line',                                    data: predictedData                                }                            ]                        };                        // 使用刚指定的配置项和数据显示图表。                        myChart.setOption(option);                    })                    .catch(error => {                        console.error(error);                    });            }        }    })</script></html>